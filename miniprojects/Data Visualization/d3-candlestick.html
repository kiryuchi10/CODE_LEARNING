<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>D3 Candlestick Chart</title>
  <style>
    body { font-family: sans-serif; }
    svg { border: 1px solid #ccc; }
    .stem { stroke: #333; }
    .up { fill: #4caf50; }
    .down { fill: #f44336; }
  </style>
</head>
<body>
  <h1>Sample OHLC Candlestick Chart</h1>
  <svg width="800" height="400"></svg>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
    // 1) Sample OHLC data
    const data = [
      { date: new Date('2025-04-01'), open: 100, high: 110, low: 90,  close: 105 },
      { date: new Date('2025-04-02'), open: 106, high: 115, low: 95,  close: 100 },
      { date: new Date('2025-04-03'), open: 101, high: 120, low: 100, close: 115 },
      { date: new Date('2025-04-04'), open: 116, high: 125, low: 110, close: 120 },
      { date: new Date('2025-04-05'), open: 121, high: 130, low: 115, close: 125 }
    ];

    // 2) Scales
    const svg = d3.select('svg'),
          margin = { top: 20, right: 20, bottom: 30, left: 50 },
          width  = +svg.attr('width')  - margin.left - margin.right,
          height = +svg.attr('height') - margin.top  - margin.bottom;

    const x = d3.scaleTime()
                .domain(d3.extent(data, d => d.date))
                .range([0, width]);

    const y = d3.scaleLinear()
                .domain([
                  d3.min(data, d => d.low),
                  d3.max(data, d => d.high)
                ]).nice()
                .range([height, 0]);

    const g = svg.append('g')
                 .attr('transform', `translate(${margin.left},${margin.top})`);

    // 3) Axes
    g.append('g')
     .attr('transform', `translate(0,${height})`)
     .call(d3.axisBottom(x));

    g.append('g')
     .call(d3.axisLeft(y));

    // 4) Draw stems (high–low lines)
    g.selectAll('line.stem')
     .data(data)
     .enter().append('line')
     .attr('class', 'stem')
     .attr('x1', d => x(d.date))
     .attr('x2', d => x(d.date))
     .attr('y1', d => y(d.high))
     .attr('y2', d => y(d.low));

    // 5) Draw candles (open–close rectangles)
    const candleWidth = 10;
    g.selectAll('rect.candle')
     .data(data)
     .enter().append('rect')
     .attr('class', 'candle')
     .attr('x', d => x(d.date) - candleWidth/2)
     .attr('y', d => y(Math.max(d.open, d.close)))
     .attr('width', candleWidth)
     .attr('height', d => Math.abs(y(d.open) - y(d.close)))
     .attr('class', d => d.close > d.open ? 'up' : 'down');
  </script>
</body>
</html>
